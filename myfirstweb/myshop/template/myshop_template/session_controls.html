<!-- Session Controls - Bottom of Page -->
<div style="text-align: center; margin-top: 50px; padding: 20px 0; border-top: 1px solid #eee;">
    <div id="session-timer" style="font-size: 11px; color: #999; margin-bottom: 8px;"></div>
    <a href="{% url 'clear_session' %}" 
       onclick="return confirm('Are you sure you want to clear your booking session? All entered data will be lost.');"
       style="background: #999; color: #fff; padding: 6px 15px; border-radius: 4px; text-decoration: none; font-size: 12px; display: inline-block; transition: all 0.3s ease; opacity: 0.7;">
        Clear Session
    </a>
</div>

<script>
    // Session timeout warning
    (function() {
        const SESSION_TIMEOUT = 600; // 10 minutes in seconds
        let timeLeft = SESSION_TIMEOUT;
        const timerElement = document.getElementById('session-timer');
        
        if (!timerElement) return; // Exit if element doesn't exist
        
        // Update timer every second
        const timer = setInterval(function() {
            timeLeft--;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            
            if (timeLeft <= 60) {
                // Less than 1 minute - show warning in red
                timerElement.style.color = '#E21C21';
                timerElement.style.fontWeight = 'bold';
                timerElement.textContent = `⚠️ Session expires in ${seconds} seconds!`;
            } else if (timeLeft <= 300) {
                // Less than 5 minutes - show warning in orange
                timerElement.style.color = '#ff8800';
                timerElement.textContent = `Session expires in ${minutes}m ${seconds}s`;
            } else {
                // More than 5 minutes - show normal
                timerElement.style.color = '#999';
                timerElement.textContent = `Session expires in ${minutes} minutes`;
            }
            
            if (timeLeft <= 0) {
                clearInterval(timer);
                timerElement.textContent = 'Session expired!';
                alert('Your session has expired. You will be redirected to start a new booking.');
                window.location.href = "{% url 'dates' %}";
            }
        }, 1000);
        
        // Reset timer on any user activity
        let resetTimer = function() {
            timeLeft = SESSION_TIMEOUT;
        };
        
        document.addEventListener('mousedown', resetTimer);
        document.addEventListener('keypress', resetTimer);
        document.addEventListener('scroll', resetTimer);
        document.addEventListener('touchstart', resetTimer);
    })();
</script>


